<Window
    x:Class="MyAthenaeio.Views.Books.BookDetailWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="clr-namespace:MyAthenaeio.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:MyAthenaeio.Views.Books"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Title="Book Details"
    Width="900"
    Height="800"
    WindowStartupLocation="CenterOwner"
    mc:Ignorable="d">

    <Window.Resources>
        <ResourceDictionary Source="/Resources/Styles.xaml" />
    </Window.Resources>

    <Grid Background="{StaticResource DarkAcademiaBackground}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <Border Grid.Row="0" Style="{StaticResource DarkAcademiaBorderStyle}">
            <TextBlock Style="{StaticResource HeaderTextBlockStyle}" Text="Book Information" />
        </Border>

        <ScrollViewer
            Grid.Row="1"
            Margin="15"
            VerticalScrollBarVisibility="Auto">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="200" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <!--  Left Column: Cover and Categories  -->
                <StackPanel Grid.Column="0" Margin="10,0,0,0">
                    <!--  Book Cover  -->
                    <Border
                        Padding="10"
                        BorderBrush="{StaticResource DarkAcademiaBorder}"
                        BorderThickness="2"
                        CornerRadius="5">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="300" />
                            </Grid.RowDefinitions>
                            <Image
                                x:Name="CoverImage"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Stretch="Uniform" />
                            <TextBlock
                                x:Name="NoCoverText"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Foreground="{StaticResource DarkAcademiaTextMuted}"
                                Text="No Cover Available"
                                Visibility="Collapsed" />
                        </Grid>
                    </Border>

                    <!--  Genres  -->
                    <GroupBox Margin="0,10,0,0" Header="Genres">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <WrapPanel x:Name="GenresWrapPanel" Grid.Row="0" />

                            <Button
                                Grid.Row="1"
                                Margin="0,5,0,0"
                                HorizontalAlignment="Left"
                                Click="AddGenre_Click"
                                Content="+ Add Genre" />
                        </Grid>
                    </GroupBox>

                    <!--  Tags  -->
                    <GroupBox Margin="0,10,0,0" Header="Tags">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <WrapPanel x:Name="TagsWrapPanel" Grid.Row="0" />

                            <Button
                                Grid.Row="1"
                                Margin="0,5,0,0"
                                HorizontalAlignment="Left"
                                Click="AddTag_Click"
                                Content="+ Add Tag" />
                        </Grid>
                    </GroupBox>

                    <!--  Collections  -->
                    <GroupBox Margin="0,10,0,0" Header="Collections">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <WrapPanel x:Name="CollectionsWrapPanel" Grid.Row="0" />

                            <Button
                                Grid.Row="1"
                                Margin="0,5,0,0"
                                HorizontalAlignment="Left"
                                Click="AddCollection_Click"
                                Content="+ Add Collection" />
                        </Grid>
                    </GroupBox>
                </StackPanel>

                <!--  Right Column: Book Info, Authors, Copies, Loan History  -->
                <StackPanel
                    Grid.Column="1"
                    Margin="15,0,0,0"
                    VerticalAlignment="Top">
                    <!--  Basic Information  -->
                    <GroupBox Header="Basic Information">
                        <Grid>
                            <Grid.Resources>
                                <Style BasedOn="{StaticResource {x:Type Label}}" TargetType="Label">
                                    <Setter Property="Margin" Value="0,0,10,10" />
                                </Style>
                                <Style BasedOn="{StaticResource {x:Type TextBox}}" TargetType="TextBox">
                                    <Setter Property="Margin" Value="0,0,0,10" />
                                </Style>
                                <Style BasedOn="{StaticResource {x:Type controls:NumberBox}}" TargetType="controls:NumberBox">
                                    <Setter Property="Margin" Value="0,0,0,10" />
                                </Style>
                                <Style BasedOn="{StaticResource {x:Type DatePicker}}" TargetType="DatePicker">
                                    <Setter Property="Margin" Value="0,0,0,10" />
                                </Style>
                            </Grid.Resources>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="120" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <Label
                                Grid.Row="0"
                                Grid.Column="0"
                                Content="Title:" />
                            <TextBox
                                x:Name="TitleTextBox"
                                Grid.Row="0"
                                Grid.Column="1" />

                            <Label
                                Grid.Row="1"
                                Grid.Column="0"
                                Content="Subtitle:" />
                            <TextBox
                                x:Name="SubtitleTextBox"
                                Grid.Row="1"
                                Grid.Column="1" />

                            <Label
                                Grid.Row="2"
                                Grid.Column="0"
                                Content="Authors:" />
                            <TextBox
                                x:Name="AuthorsTextBox"
                                Grid.Row="2"
                                Grid.Column="1"
                                ToolTip="Separate multiple authors with commas" />

                            <Label
                                Grid.Row="3"
                                Grid.Column="0"
                                Content="ISBN-10:" />
                            <TextBox
                                x:Name="ISBN10TextBox"
                                Grid.Row="3"
                                Grid.Column="1"
                                LostFocus="ISBN10TextBox_LostFocus" />

                            <Label
                                Grid.Row="4"
                                Grid.Column="0"
                                Content="ISBN-13:" />
                            <TextBox
                                x:Name="ISBN13TextBox"
                                Grid.Row="4"
                                Grid.Column="1"
                                LostFocus="ISBN13TextBox_LostFocus" />

                            <Label
                                Grid.Row="5"
                                Grid.Column="0"
                                Content="Description:" />
                            <TextBox
                                x:Name="DescriptionTextBox"
                                Grid.Row="5"
                                Grid.Column="1"
                                Height="100"
                                AcceptsReturn="True"
                                TextWrapping="Wrap"
                                VerticalScrollBarVisibility="Auto" />

                            <Label
                                Grid.Row="6"
                                Grid.Column="0"
                                Content="Publisher:" />
                            <TextBox
                                x:Name="PublisherTextBox"
                                Grid.Row="6"
                                Grid.Column="1" />

                            <Label
                                Grid.Row="7"
                                Grid.Column="0"
                                Content="Pub. Year:" />
                            <controls:NumberBox
                                x:Name="PublicationYearTextBox"
                                Grid.Row="7"
                                Grid.Column="1"
                                Maximum="9999"
                                Step="1" />

                            <Label
                                Grid.Row="8"
                                Grid.Column="0"
                                Content="Cover URL:" />
                            <Grid Grid.Row="8" Grid.Column="1">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <TextBox x:Name="CoverUrlTextBox" Grid.Column="0" />
                                <Button
                                    Grid.Column="1"
                                    Margin="10,0,0,10"
                                    Click="FetchCover_Click"
                                    Content="Fetch Cover"
                                    ToolTip="Fetch cover from a URL" />
                            </Grid>
                        </Grid>
                    </GroupBox>

                    <!--  Authors Details  -->
                    <GroupBox
                        x:Name="AuthorsGroupBox"
                        Margin="0,10,0,0"
                        Header="Authors Details">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <DataGrid
                                x:Name="AuthorsDataGrid"
                                Grid.Row="0"
                                Height="120"
                                AutoGenerateColumns="False"
                                IsReadOnly="True"
                                MouseDoubleClick="AuthorsDataGrid_MouseDoubleClick">
                                <DataGrid.Columns>
                                    <DataGridTextColumn
                                        Width="*"
                                        Binding="{Binding Name}"
                                        Header="Name" />
                                    <DataGridTextColumn
                                        Width="120"
                                        Binding="{Binding OpenLibraryKey}"
                                        Header="OL Key" />
                                    <DataGridTemplateColumn Width="80" Header="Actions">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <Button
                                                    Margin="5"
                                                    Padding="5,2"
                                                    Click="RemoveAuthor_Click"
                                                    Content="Remove"
                                                    Tag="{Binding}" />
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                </DataGrid.Columns>
                            </DataGrid>
                            <StackPanel
                                Grid.Row="1"
                                Margin="0,5,0,0"
                                HorizontalAlignment="Right"
                                Orientation="Horizontal">
                                <Button Click="AddAuthor_Click" Content="Add Author" />
                            </StackPanel>
                        </Grid>
                    </GroupBox>

                    <!--  Copies  -->
                    <GroupBox
                        x:Name="CopiesGroupBox"
                        Margin="0,10,0,0"
                        Header="Copies">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <DataGrid
                                x:Name="CopiesDataGrid"
                                Grid.Row="0"
                                Height="120"
                                AutoGenerateColumns="False"
                                IsReadOnly="True"
                                MouseDoubleClick="CopiesDataGrid_MouseDoubleClick">
                                <DataGrid.Columns>
                                    <DataGridTextColumn
                                        Width="100"
                                        Binding="{Binding CopyNumber}"
                                        Header="Copy #" />
                                    <DataGridTextColumn
                                        Width="150"
                                        Binding="{Binding AcquisitionDate, StringFormat='{}{0:yyyy-MM-dd}'}"
                                        Header="Acquisition Date" />
                                    <DataGridTemplateColumn Width="100" Header="Available">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <CheckBox
                                                    HorizontalAlignment="Center"
                                                    IsChecked="{Binding IsAvailable, Mode=OneWay}"
                                                    IsEnabled="False" />
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    <DataGridTextColumn
                                        Width="*"
                                        Binding="{Binding Notes}"
                                        Header="Notes" />
                                </DataGrid.Columns>
                            </DataGrid>

                            <StackPanel
                                Grid.Row="1"
                                HorizontalAlignment="Right"
                                Orientation="Horizontal">
                                <Button
                                    Margin="5"
                                    Click="AddCopy_Click"
                                    Content="Add New Copy" />
                            </StackPanel>
                        </Grid>
                    </GroupBox>

                    <!--  Loan History  -->
                    <GroupBox
                        x:Name="LoanHistoryGroupBox"
                        Margin="0,10,0,0"
                        Header="Loan History">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>
                            <DataGrid
                                x:Name="LoanHistoryDataGrid"
                                Grid.Row="0"
                                Height="150"
                                AutoGenerateColumns="False"
                                IsReadOnly="True"
                                MouseDoubleClick="LoanHistoryDataGrid_MouseDoubleClick">
                                <DataGrid.Columns>
                                    <DataGridTextColumn
                                        Width="80"
                                        Binding="{Binding BookCopy.CopyNumber}"
                                        Header="Copy #" />
                                    <DataGridTextColumn
                                        Width="*"
                                        Binding="{Binding Borrower.Name}"
                                        Header="Borrower" />
                                    <DataGridTextColumn
                                        Width="120"
                                        Binding="{Binding CheckoutDate, StringFormat='{}{0:yyyy-MM-dd}'}"
                                        Header="Loan Date" />
                                    <DataGridTextColumn
                                        Width="120"
                                        Binding="{Binding EffectiveDueDate, StringFormat='{}{0:yyyy-MM-dd}'}"
                                        Header="Due Date" />
                                    <DataGridTextColumn
                                        Width="120"
                                        Binding="{Binding ReturnDate, StringFormat='{}{0:yyyy-MM-dd}'}"
                                        Header="Return Date" />
                                </DataGrid.Columns>
                            </DataGrid>
                            <StackPanel
                                Grid.Row="1"
                                HorizontalAlignment="Right"
                                Orientation="Horizontal">
                                <Button
                                    Margin="5"
                                    Click="ManageLoans_Click"
                                    Content="Manage Loans" />
                            </StackPanel>
                        </Grid>
                    </GroupBox>
                </StackPanel>
            </Grid>
        </ScrollViewer>

        <StackPanel
            Grid.Row="2"
            Margin="15"
            HorizontalAlignment="Right"
            Orientation="Horizontal">
            <Button Click="Save_Click" Content="Save" />
            <Button Click="Cancel_Click" Content="Cancel" />
        </StackPanel>
    </Grid>
</Window>